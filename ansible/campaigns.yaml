- name: Copy script
  copy:
    src: campaign.sh
    dest: /tmp
    mode: 0777
- name: Copy campaign file
  copy:
    src: campaign.json
    dest: /tmp
    mode: 0600

- shell: cat /proc/cpuinfo > /tmp/cpuinfo

- name: Copy cpuinfo
  fetch:
    src: /tmp/cpuinfo
    dest: "{{ result_dir }}/{{ campaign }}-{{ cloud_provider }}-{{ machine }}.cpuinfo"
    flat: yes

- name: Do the actual job
  shell: /tmp/campaign.sh /tmp/campaign.json /tmp/campaign.csv
  async: 86400
  poll: 30

- name: Copy results
  fetch:
    src: /tmp/campaign.csv
    dest: "{{ result_dir }}/{{ campaign }}-{{ cloud_provider }}-{{ machine }}.csv"
    flat: yes


